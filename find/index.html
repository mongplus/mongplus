<?
include $_SERVER['DOCUMENT_ROOT']."/inc/meta.html";
include $_SERVER['DOCUMENT_ROOT']."/inc/header.html";
include $_SERVER['DOCUMENT_ROOT']."/inc/expert-sub_nav.html";
include $_SERVER['DOCUMENT_ROOT']."/_library/function_member.php";

if (!$page) $page		=	1;
if (!$limit) $limit		=	20;
$PARAM			=	"&order=$order&find_text=$find_text&find_object=$find_object&option_no=$option_no&city=$city&area=$area&option_name=$option_name";

$member_infos = $db->get_data("SELECT * FROM member WHERE user_id='".$M_login['user_id']."'");

$add_query  .= " AND level='2' AND is_use='Y'";

if($city != ''){
	$add_query .= " AND city_no='".$city."'";
}

if($area != ''){
	$add_query .= " AND area_no='".$area."'";
}

if($option_name !=''){
	$add_query .= " AND option_data like '%".$option_name."%'";
}else if($option_no != ''){
	$add_query .= " AND option_no like '%".$option_no."%'";
}

$condition = array(
				"row"			=>	$limit,
				"page"			=>	$page,
				"order"			=>	$order,
				"find_text"		=>	$find_texts,
				"find_object"	=>	$find_objects,
				"add_query"		=>	$add_query,
			);

$list				=	F_member_list($condition);

$citys = $db->get_list("SELECT * FROM city WHERE 1");
?>
<script language="javascript">
$(document).ready(function(){
	var option_no = "<?=$option_no?>";
	var area_no = "<?=$area?>";

	$(document).on("click",".reset_btn",function(){
		location.href = "/expert/find/";
	});

	//시/도 선택
	$(document).on("change",'.cityIn',function(){
		var city_no = $(this).val();

		if(city_no != ''){
			$.post("./info.php",{
				mode	:"area_read",
				city_no : city_no,
				area_no : area_no
			},function(e){
				$('[name="area"]').find('option').not(":eq(0)").remove();
				$('[name="area"]').append(e.html);
				if(city_no == 6){
					$('[name="area"]').hide();
				}else{
					$('[name="area"]').show();
				}
			},"json");
		}else{
			$('[name="area"]').find('option').not(":eq(0)").remove();
		}
	});

	$(document).on("change",'.filter_option_div select',function(){
		var sel = $(this).attr("name");

		if($(this).val() != ''){
			$('.filter_option_div select').each(function(){
				if($(this).attr("name") != sel){
					$(this).val("");
				}
			});

			$('[name="option_name"]').val("");
		}
	});

	$(document).on("click",".filter_apply_btn",function(){
		var frm = $('[name="s_frm"]');
		var option_name = $('[name="option_name"]').val();

		if($.trim(option_name) == ''){
			if($('.filter_option_div').find('select').length > 0){
				$('.filter_option_div').find('select').each(function(){
					if($(this).val() != ''){
						option_no = $(this).val();
					}
				});
			}
		}

		$('[name="option_no"]').val(option_no);

		frm.submit();
	});

	$(document).on("click",".channerBtn",function(){
		var member_no = $(this).data("no");
		$.post("./info.php",{
			mode : "member_channel_in",
			member_no : member_no
		},function(e){
			alert(e.msg);
			window.location.reload();
		},"json");
	});

	$(".cityIn").change();

	$.post("./info.php",{
		mode : "read_filter_option2",
		option_no : option_no
	},function(e){
		$('.filter_option_div').find("select").remove();
		$('.filter_option_div').find("input").before(e.html);
	},"json");
});
</script>
	<main id="mainContainer">

		<div id="mainCon_inner" class="clearfix">
		
			<div class="leftDiv talk_leftDiv pb100">
				
				<form method="get" name="s_frm" action="<?=$PHP_SELF?>">
				<input type="hidden" name="option_no" value="">
				<section class="f0 section_search search_filter" style="margin-top:42px;">

					<span class="filter_icon">						
					</span>
					<p class="bS p16 p16_f_w_b">
						필터
					</p>
					
					<button type="button" class="reset_btn">
						<span class="reset_btn_icon"></span><span>초기화</span>
					</button>
				
					
					<div class="select_btn_box select_btn_box_top">

						<div class="f0 pr wh100 pb15">
							<p class="p15 p15_f_w_b">
							활동지역
							</p>
						</div>


						<select class="sub_select sub_select2 cityIn" name="city">
							<option value="">
							시/도
							</option>
							<?
							for($i=0;$i<count($citys['city_no']);$i++){
								$selected = '';
								if($citys['city_no'][$i] == $city){
									$selected = "selected";
								}
							?>
								<option value="<?=$citys['city_no'][$i]?>" <?=$selected?>><?=$citys['name'][$i]?></option>
							<?
							}
							?>
						</select>
						<select class="sub_select sub_select2 areaIn" name="area">
							<option value="">
							구/군
							</option>
						</select>
						
					</div><!-- select_btn_box end -->
				
					
					<div class="select_btn_box filter_option_div">

						<div class="f0 pr wh100 pb15">
							<p class="p15 p15_f_w_b">
							활동분야
							</p>
						</div>


						<!--<select class="sub_select">
							<option>
							의료서비스
							</option>
						</select>
						<select class="mt20 sub_select">
							<option>
							교육/훈련/치유

							</option>
						</select>
						<select class="mt20 sub_select">
							<option>
							서비스/문화

							</option>
						</select>
						<select class="mt20 sub_select">
							<option>
							사료/간식

							</option>
						</select>
						<select class="mt20 sub_select">
							<option>
							기타
							</option>
						</select>-->
					<input type="text" class="mt15 joinInput" style="display:none;" name="option_name" placeholder="직접입력" value="<?=$option_name?>" />
						
					</div><!-- select_btn_box end -->
					
					
					<div class="select_btn_box select_btn_box_last">
						
						<input type="button" value="필터적용" class="filter_apply_btn" />
						
					</div><!-- select_btn_box end -->
				
				
				
					
					

					
				
				</section><!-- section_search end -->
				</form>
				
				
				
				
			
			
			</div><!-- leftDiv end -->

			<div class="rightDiv talk_rightDiv pb100">


				<section class="userList">
					
					<div class="row">
					
					
<?
for($i=0;$i<count($list['member_no']);$i++){
	if($member_infos['member_no'] != ''){
		$channel = $db->get_data("SELECT * FROM member_channel WHERE member_no='".$list['member_no'][$i]."' AND members_no='".$member_infos['member_no']."'");
	}else{
		$channel = array();
	}
?>
						<div class="userList_content">
							<div class="profileImg">					
								<span class="certification2"><!-- 인증 ic-->
								</span>
								<div class="Img">
								<img src="/upload/member/<?=$list['file2'][$i]?>" onclick="location.href='/expert/talk/channel_user.html?member_no=<?=$list['member_no'][$i]?>'" />	
								</div>
							</div>
								
							<div class="profileCon">

								<div class="name">						
									<a onclick="location.href='/expert/talk/channel_user.html?member_no=<?=$list['member_no'][$i]?>'">
									<?=$list['nickname'][$i]?>
									</a>
								</div>

								<div class="subTxt">
									<a onclick="location.href='/expert/talk/channel_user.html?member_no=<?=$list['member_no'][$i]?>'">
									<?=$list['one_text'][$i]?>
									</a>
								</div>

								<? if($channel['channel_no'] != ''){ ?>
								<div class="subscribeBt subscribeActive mt15 channerBtn" data-no="<?=$list['member_no'][$i]?>">
									구독중
								</div>
								<? }else{ ?>
								<div class="subscribeBt mt15 channerBtn" data-no="<?=$list['member_no'][$i]?>">
									+ 구독
								</div>
								<? } ?>

							</div>
							
						</div><!-- userList_content end -->
<? } ?>
					
					
						
											
					</div><!-- row end -->
				
				</section>

			</div><!-- rightDiv end -->
			
		</div><!-- mainCon_inner end -->
	</main><!-- main end -->
	
	
<?
include $_SERVER['DOCUMENT_ROOT']."/inc/foot.html";
?>